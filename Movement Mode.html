<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SunnyFit 专业跟练 Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-red: #DE2529;
            --glass-bg: rgba(0, 0, 0, 0.5);
            --ui-white: #FFFFFF;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; font-family: 'Montserrat', sans-serif;
            overflow: hidden; color: #fff;
        }

        .workout-container {
            position: relative;
            width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; /* 点击屏幕任何地方触发控制 */
        }

        /* --- 视频画面层 --- */
        .video-layer {
            position: absolute;
            transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow: hidden;
            background: #111;
        }
        .main-view { width: 100%; height: 100%; z-index: 1; }
        .sub-view {
            width: 320px; height: 180px;
            bottom: 40px; right: 40px;
            z-index: 50;
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
        }
        video { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

        .tag {
            position: absolute; top: 12px; left: 12px;
            background: var(--brand-red); font-size: 10px; font-weight: 800;
            padding: 2px 8px; border-radius: 4px; z-index: 2;
        }

        /* --- 顶部进度条 --- */
        .top-timeline {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            display: flex; gap: 4px; padding: 0 10px; box-sizing: border-box; z-index: 100;
        }
        .segment { flex: 1; height: 100%; background: rgba(255,255,255,0.2); }
        .segment.active { background: var(--brand-red); }

        /* --- 左侧数据看板 (已重构) --- */
        .side-stats {
            position: absolute; top: 40px; left: 30px; z-index: 100;
            display: flex; flex-direction: column; gap: 20px;
            pointer-events: none;
        }
        .workout-name { font-size: 24px; font-weight: 800; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        
        .data-column {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            padding: 25px; border-radius: 20px; width: 150px;
            display: flex; flex-direction: column; gap: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* 计数圆环嵌入左侧 */
        .counter-ring-box {
            position: relative; width: 100px; height: 100px; margin: 0 auto;
        }
        .ring-svg { transform: rotate(-90deg); }
        .ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 6; }
        .ring-active { 
            fill: none; stroke: var(--brand-red); stroke-width: 8; 
            stroke-dasharray: 283; stroke-dashoffset: 180; stroke-linecap: round;
        }
        .ring-content {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .ring-num { font-size: 28px; font-weight: 800; line-height: 1; }
        .ring-total { font-size: 12px; opacity: 0.6; }

        .metric { display: flex; flex-direction: column; }
        .m-val { font-family: 'Roboto Mono', monospace; font-size: 28px; font-weight: 700; line-height: 1.1; }
        .m-lbl { font-size: 10px; color: #ccc; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }

        /* --- 中央点击控制层 (New) --- */
        .center-controls {
            position: absolute; inset: 0; z-index: 200;
            background: rgba(0,0,0,0.4);
            display: flex; justify-content: center; align-items: center; gap: 60px;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .center-controls.active { opacity: 1; pointer-events: auto; }

        .ctrl-btn {
            display: flex; flex-direction: column; align-items: center; gap: 15px;
            transition: transform 0.2s ease; cursor: pointer;
        }
        .ctrl-btn:hover { transform: scale(1.1); }
        .ctrl-icon-circle {
            width: 90px; height: 90px; border-radius: 50%;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            border: 2px solid rgba(255,255,255,0.5);
        }
        .pause-icon { width: 30px; height: 35px; border-left: 10px solid #fff; border-right: 10px solid #fff; box-sizing: border-box; }
        .stop-icon { width: 32px; height: 32px; background: #fff; border-radius: 4px; }
        .ctrl-label { font-size: 14px; font-weight: 700; letter-spacing: 1px; }

    </style>
</head>
<body>

<div class="workout-container" onclick="toggleControls()">
    
    <div class="top-timeline">
        <div class="segment active" style="width: 30%;"></div>
        <script>for(let i=0; i<12; i++) document.write('<div class="segment"></div>')</script>
    </div>

    <div id="coachLayer" class="video-layer main-view">
        <div class="tag">COACH VIDEO</div>
        <video id="coachVideo" autoplay muted loop>
            <source src="./S168.mp4" type="video/mp4">
        </video>
    </div>

    <div id="userLayer" class="video-layer sub-view" onclick="event.stopPropagation(); toggleViews();">
        <div class="tag">YOUR CAMERA</div>
        <video id="userCam" autoplay muted playsinline></video>
    </div>

    <div class="side-stats">
        <div class="workout-name">1/15 Jumping Jack</div>
        <div class="data-column">
            <div class="counter-ring-box">
                <svg width="100" height="100" class="ring-svg">
                    <circle cx="50" cy="50" r="45" class="ring-bg"/>
                    <circle cx="50" cy="50" r="45" class="ring-active"/>
                </svg>
                <div class="ring-content">
                    <span class="ring-num">3</span>
                    <span class="ring-total">/10</span>
                </div>
            </div>

            <div class="metric">
                <span class="m-val">02:03</span>
                <span class="m-lbl">Time Elapsed</span>
            </div>
            <div class="metric">
                <span class="m-val">223</span>
                <span class="m-lbl">Calories (kcal)</span>
            </div>
            <div class="metric">
                <span class="m-val" id="hrValue">98</span>
                <span class="m-lbl">Heart Rate</span>
            </div>
        </div>
    </div>

    <div class="center-controls" id="centerControls">
        <div class="ctrl-btn" onclick="event.stopPropagation(); handlePause();">
            <div class="ctrl-icon-circle">
                <div class="pause-icon"></div>
            </div>
            <span class="ctrl-label">PAUSE</span>
        </div>
        <div class="ctrl-btn" onclick="event.stopPropagation(); handleStop();">
            <div class="ctrl-icon-circle" style="background: var(--brand-red); border-color: transparent;">
                <div class="stop-icon"></div>
            </div>
            <span class="ctrl-label">EXIT</span>
        </div>
    </div>

</div>

<script>
    let timer;

    // 1. 初始化摄像头
    async function setupCam() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('userCam').srcObject = stream;
        } catch (e) {
            document.getElementById('userCam').poster = "https://via.placeholder.com/400x225/222/555?text=USER+CAM";
        }
    }

    // 2. 切换主副画面
    let coachIsMain = true;
    function toggleViews() {
        const coach = document.getElementById('coachLayer');
        const user = document.getElementById('userLayer');
        coach.classList.toggle('main-view'); coach.classList.toggle('sub-view');
        user.classList.toggle('main-view'); user.classList.toggle('sub-view');
        coachIsMain = !coachIsMain;
    }

    // 3. 屏幕中央控制层逻辑
    function toggleControls() {
        const ctrl = document.getElementById('centerControls');
        ctrl.classList.add('active');
        
        // 自动消失逻辑
        clearTimeout(timer);
        timer = setTimeout(() => {
            ctrl.classList.remove('active');
        }, 3000);
    }

    // 4. 控制操作模拟
    function handlePause() {
        const v = document.getElementById('coachVideo');
        if (v.paused) {
            v.play();
            alert("Workout Resumed");
        } else {
            v.pause();
            alert("Workout Paused");
        }
    }

    function handleStop() {
        if(confirm("Exit this workout?")) {
            window.location.href = './Workout_result_light.html';
        }
    }

    // 5. 模拟心率跳动
    setInterval(() => {
        const hr = document.getElementById('hrValue');
        hr.innerText = 95 + Math.floor(Math.random() * 8);
    }, 2000);

    setupCam();
</script>

</body>
</html>